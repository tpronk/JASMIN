<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
    <head>
        <title></title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <!-- EventManager -->
        <script type="text/javascript" src="../../trunk/www/static/js/plugins/jQuery.js"></script>
        <script type="text/javascript" src="../../trunk/www/static/js/task2/EventManager.js"></script>
        <script type="text/javascript" src="jquery.js"></script>
        
        <script type="text/javascript">
            // The EventManager times events and registers responses. 
            
            // When constructing an EventManager, attach it to the window
            eventManager  = new EventManager( window );
            
            // Start an event (that ignores responses) as follows
            this.eventManager.startEvent(
                {},                               // responses - What responses are registered?
                200,                              // timeout   - When does this event timeout 
                callback1(),                      // callback  - Function to return to after event
                null,                             // params    - Stuff to pass to callback
                "a nice param",                   // name      - Name of this event
				false
            );   
        
        
// AJAX Functions
            ajaxSend = function( url, dataType, sendMe, callback )
            {
                $( "#output" ).append( "AJAX sending to " + url + ", dataType = ", dataType, ", sendMe = ", JSON.stringify( sendMe ) + "\n" );
                $.ajax( {
                      url:      url,
                      async:    true,
                      data:     "data=" +  encodeURI( JSON.stringify( sendMe ) ),
                      dataType: dataType,
                      type:     "POST",
                      context:  this,
                      success:  function( data, status ) {
                         ajaxReceive( true, data, status, callback );
                      },
                      error:    function( data, status ) {
                         ajaxReceive( false, data, status, callback );
                      }
                } );                
            };
            
            ajaxReceive = function( success, receiveMe, status, callback )
            {
                $( "#output" ).append( "AJAX receiving. Success? " + success + ", status = " + status + ", receiveMe = " + JSON.stringify( receiveMe ) + "\n" );
                callback();
            };
            
            // Done JSON, do picture
            doneJSON = function()
            {
                $( "#output" ).append( "Loading a picture\n" );
                
                // TEST Load image
                var image = $( "<img>" ).attr( 
                        "src", "image.jpg"
                    ).load( function() {
                        $( "#output" ).append( "image.jpg loaded \n" );
                        $( "#imageHere" ).append( image );
                    } ).error( function() {
                        $( "#output" ).append( "image.jpg loading error \n" );
                    }
                );                
            };
                
            
            // TEST is jQuery available?
            if( ( typeof jQuery === 'undefined' ) )
            {
                alert( "jQuery undefined" );
            }
            
            $( document ).ready( function() {
                // TEST do simple jQuery
                $( "#output" ).append( "This text was drawn with jQuery\n" );
                
                // TEST AJAX: Post and receive JSON
                $( "#output" ).append( "Sending JSON\n" );
                var sendMe = { "event" : "test", "value" : [1,2,3] };
                ajaxSend( "some_json.json", "json", sendMe, doneJSON );                
            } );
        </script>
    </head>
    <body>
<pre id="output">
Text blue? Then CSS loaded
</pre>
        <div id="imageHere"></div>
       <a href="done.html" />Goto done.html</a>
    </body>