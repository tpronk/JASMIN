<!--
//Copyright 2014, Thomas Pronk
//
//Licensed under the Apache License, Version 2.0 (the "License");
//you may not use this file except in compliance with the License.
//You may obtain a copy of the License at
//
//http://www.apache.org/licenses/LICENSE-2.0
//
//Unless required by applicable law or agreed to in writing, software
//distributed under the License is distributed on an "AS IS" BASIS,
//WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
//See the License for the specific language governing permissions and
//limitations under the License. 

Measures framerate per second. Classifies frame duration in multiple classes,
depending on how long it took.
-->
<html>
    <head>
        <script type="text/javascript">
            
// http://paulirish.com/2011/requestanimationframe-for-smart-animating/
// http://my.opera.com/emoller/blog/2011/12/20/requestanimationframe-for-smart-er-animating
 
// requestAnimationFrame polyfill by Erik Möller
// fixes from Paul Irish and Tino Zijdel            
(function() {
    var lastTime = 0;
    var vendors = ['ms', 'moz', 'webkit', 'o'];
    for(var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
        window.requestAnimationFrame = window[vendors[x]+'RequestAnimationFrame'];
        window.cancelAnimationFrame = window[vendors[x]+'CancelAnimationFrame']
                                   || window[vendors[x]+'CancelRequestAnimationFrame'];
    }
 
    if (!window.requestAnimationFrame)
        window.requestAnimationFrame = function(callback, element) {
            var currTime = new Date().getTime();
            var timeToCall = Math.max(0, 16 - (currTime - lastTime));
            var id = window.setTimeout(function() { callback(currTime + timeToCall); },
              timeToCall);
            lastTime = currTime + timeToCall;
            return id;
        };
 
    if (!window.cancelAnimationFrame)
        window.cancelAnimationFrame = function(id) {
            clearTimeout(id);
        };
}());

clockTime = function()
{
    if( now !== -1 )
    {
        then = now;
        now  = window.performance.now();
        
        if( now - then < 33 ) {
            counterLow++;
        } else if( now - then < 100 ) {
            counterMed++;
        } else if( now - then < 200 ) {
            counterHigh++;
        } else {
            counterHuge++;
        }
    } else {
        now  = window.performance.now();
    }
    
    if( now - startTime > 1000 )
    {
        document.getElementById( "output" ).innerHTML +=  
            counterLow  + "\t" +
            counterMed  + "\t" +
            counterHigh + "\t" +
            counterHuge + "\n";
        resetCounters();
    }
    
    window.requestAnimationFrame( clockTime );
}

resetCounters = function()
{
    counterLow  = 0;
    counterMed  = 0;
    counterHigh = 0;
    counterHuge = 0;
    startTime = window.performance.now();
}

window.onload = function() {
    // Headers
    document.getElementById( "output" ).innerHTML +=  
        "&lt;33\t" +
        "&lt;100\t" +
        "&lt;200\t" +
        "&gt;=200\n";

    now = -1;
    resetCounters();
    window.requestAnimationFrame( clockTime );
    }
        </script>
    </head>
    <body>
        <pre id="output"></pre>
    </body>
</html>