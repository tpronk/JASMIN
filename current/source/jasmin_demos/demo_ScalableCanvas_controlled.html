<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd"> 
<!--
Copyright 2014, Thomas Pronk

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software
distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and
limitations under the License. 


Demo of a ScalableCanvas in a controlled web-page.
-->
<html>
    <head>
        <title></title>
        <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
        <meta name="viewport" content="width = device-width, height = device-height, user-scalable = no">        
        <!-- jQuery -->
        <script type="text/javascript" src="../jasmin_ext/jquery.js"></script>
        <link rel="stylesheet" type="text/css" href="../jasmin_ext/jquery.mobile.structure-1.3.2.min.css" />
        
        <script type="text/javascript">
// No reporting
report = function() {};

// Loading a script at url, on success call callback
getScripts = function( urls, callback )
{
    scriptsToLoad   = urls;
    currentCallback = callback;
    getScript( 0 );
}

getScript = function( scriptsToLoadCounter )
{
    if( scriptsToLoadCounter < scriptsToLoad.length )
    {
        url = scriptsToLoad[ scriptsToLoadCounter ];
        report( "run_demo", "getScript downloading " + ( scriptsToLoadCounter + 1 ) + "/" + scriptsToLoad.length + ": " + url );
        var request = jQuery.ajax({
            type: "GET",
            crossDomain: true,
            dataType: "script",
            url: url
        } );
        request.done( function(){
                report( "run_demo", "getScript downloading success" );
                getScript( scriptsToLoadCounter + 1 );
        } );
        request.fail( function( errorData ){
                report( "run_demo", "getScript downloading fail:" + JSON.stringify( errorData ) );
        } );                    
    } else {
        currentCallback();
    }
};
            

// Path to jasmin
var jasminPath = "../";
var demoName   = "demo_ScalableCanvas_controlled.js";

minimizeBody = function() {
    $( "body" ).css( {
        "width" : "1px",
        "height" : "1px"        
    } );
}

$( document ).ready( function() {
    load();
} );

// Called on page load
load = function() {
    // Load ScalableCanvas JS file
    getScripts( [
            jasminPath + "jasmin_ext/screenfull.js",
            jasminPath + "jasmin_ext/jquery.mobile.js",
            jasminPath + "jasmin_core/ScalableCanvas.js"
        ],
        startCanvas
    );
}

startCanvas = function()
{
    minimizeBody();
    $(window).bind('orientationchange', function( event ) { 
        minimizeBody();
    } );
    
    // Setup two sprites (background & text_box) to add to the canvas. 
    // Note that each sprite has two properties:
    //  * "node" contains the object and CSS properties that not need scaling
    //  * "scalable" contains the object and CSS properties that do need scaling
    var sprites = {
        // A black background; rectangle size of canvas
        "background" :
        {
            // "node" contains the object and CSS properties that not need scaling
            "node" :
                $( "<div>" ).css( {
                    "z-index"          : 1,
                    "background-color" : "#000000",
                    "opacity"          : 1
                } ),
            // "scalable" contains the object and CSS properties that do need scaling
            "scalable" :
                {
                    "width"  : "1.6",
                    "height" : "1",
                    "left"   : "0",
                    "top"    : "0"
                }
        },        
        // Grey div within which a centered red text
        "text_box" : 
        {
            // Container DIV; text will be center aligned inside of this DIV
            "node" :        
                $( "<div>" ).attr( {
                    "id" : "touch_me"
                } ).css( {
                    "z-index"          : 2,
                    "text-align"       : "center",
                    "color"            : "red",
                    "display"          : "table",
                    "font-weight"      : "bold",
                    "background-color" : "#666666"
                } ).append( 
                        // The actual text; change contents via id "my_text"
                        $( "<p>" ).attr( {
                            "id" : "my_text"
                        } ).css( {
                            "vertical-align"   : "middle",
                            "text-align"       : "center",
                            "display"          : "table-cell"
                        } ).text( "Touch Me" )
                ),
            // scalable; all properties you want to scale
            "scalable" :            
                {
                    "width"        :  .8,
                    "height"       :  .4,
                    "left"         :  .4,
                    "top"          :  .4,
                    "font-size"    :  .08
                }    
        },
        // A text input field, let's see if this works
        "text_input" : 
        {
            // Container DIV; text will be center aligned inside of this DIV
            "node" :        
                $( "<input>" ).attr( { "value" : "Type text here" } ).css( {
                    "z-index"   : 3,
                    "padding"   : "0px",
                    "border"    : "0px",
                } ),
            // scalable; all properties you want to scale
            "scalable" :            
                {
                    "width"        :  .8,
                    "height"       :  .15,
                    "left"         :  .4,
                    "top"          :  .1,
                    "font-size"    :  .08
                }    
        }
    };

    // Construct canvas
    var canvas      = new ScalableCanvas( 
        $( "#graphics_here" ),  // container div; note though that canvas scales to the window
        1.6                     // aspectRatio (x/y). A value of 1.6 gives this range of coordinates: x[0:1.6] and y[0:1]
        // rescaleInterval (number of ms between checking rescaling), 1000 by default
    );
    
    // Add sprites to canvas
    canvas.addSprites( sprites );

    // Add canvas to target
    //$( this.target ).append( this.container );
    
    // Start rescaling
    canvas.start();   
    
    // Fullscreen if touchMe is clicked
    $( "#touch_me" ).bind( 
        "vmousedown",
        "all",
        function( event ) {
            screenfull.request();
        } 
    );       
};


// Initialise touch fields and create eventManager
setupDemo = function() {
    // Setup touch divs
    var buttonLeft = $( "<div>" ).attr( {
        "id" : "left"
    } ).css( {
        "width"  : "100px",
        "height" : "100px",
        "position" : "relative",
        "left" : "0px",
        "background-color" : "red"
    } );
    $( "#graphics_here" ).append( buttonLeft );
    var buttonRight = $( "<div>" ).attr( {
        "id" : "right"
    } ).css( {
        "width"  : "100px",
        "height" : "100px",
        "position" : "absolute",
        "left"   : "120px",
        "top"    : "0px",
        "z-index" : 2,
        "background-color" : "blue"
    } );
    $( "#graphics_here" ).append( buttonRight );

    // Create an EventManager
    eventManager = new EventManager( window );    
    
    // Start touchRespnose
    touchResponseStart();
}

// Called when EventManager JS file loaded
touchResponseStart = function() {
    report( "", "" );
    report( demoName, "Starting an event that registers vmousedown on the divs above and lasts 2000 ms" );
    
    // Buttons for next event: vmousedown on buttonLeft or buttonRight
    // Note that vmousedown is provided by a jquery-mobile as a unified way
    // to register mouse clicks and touch events (without any 300 ms 'click'
    // delay.
    var buttons = { 
        "vmousedown" : {
            // No type key (as with keyboard)
            "buttons" : {
                "#left"  : "left",
                "#right" : "right"
            }
        }
    };
    
    eventManager.startEvent(
        buttons,              // responses - No responses are registered
        2000,                 // timeout   - No. of ms to time out
        touchResponseDone,    // callback  - Function to return to after event
        "noResponse"          // name      - Name of this event
    );
}


// Called when noResponse done
touchResponseDone = function( eventData )
{
    report( demoName, "Event done, eventData = " + JSON.stringify( eventData ) );
    reportEventData( eventData );
    
    // Repeat touchEvent
    touchResponseStart();
}

</script>
</head>
<body>
<div id="graphics_here"></div>
</body>
</html>